{% extends 'base.html' %}

{% block head %}
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
     integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
     crossorigin=""/>
{% endblock head %}

{% block jsfooter %}
 <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
     integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
     crossorigin=""></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">

<script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script>
    // Creating map options
    var mapOptions = {
        center: [48.99707935, 8.47255828438081],
        zoom: 15
    }
    // Creating a map object
    var map = new L.map('map', mapOptions);
    // Creating a Layer object
    var layer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
    // Adding layer to the map
    map.addLayer(layer);

    let locations = [
{% for appointment in appointment_list %}
        {
            "id": {{appointment.id}},
            "lat": {{appointment.lat}},
            "long": {{appointment.lon}},
            "title": "{{appointment.contact_name}}",
            "address": "{{appointment.street}} {{appointment.house_number}}",
            "date": "{{appointment.timeslot.date}}"
        },
{% endfor %}
    ]

    let popupOption = {
        "closeButton":false
    }

    var markers = new L.markerClusterGroup();
    var bounds = [];

    locations.forEach(element => {
        bounds.push([element.lat,element.long])
        var marker = new L.Marker([element.lat,element.long])
        .on("mouseover",event =>{
            event.target.bindPopup('<div>'+element.title+'<br>'+element.address+'<br>Abholdatum:'+element.date+'</div>',popupOption).openPopup();
        })
        .on("mouseout", event => {
            event.target.closePopup();
        })
        markers.addLayer(marker);
    });
    map.addLayer(markers);
    map.fitBounds(new L.LatLngBounds(bounds));
</script>
{% endblock jsfooter%}

{% block data %}
<div id="map" style="width: 100%; height: 750px"></div>
{% endblock data %}